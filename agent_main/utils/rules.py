formation = '''\
'''

distance = '''\
当部署指令中包括距离信息时，你需要一些理解距离计算的方法，下面以南侧为示例进行说明：
    1. 定义方位和距离的基本规则
        方位规则: "南侧是从参考点向正南方向移动的方向。"
        距离规则: "从参考点出发，沿着指定的方向移动一定距离，得到新的位置。"
    2. 使用坐标进行计算（基于经纬度）
        参考点的坐标: "假设xx公交站的坐标是(x, y)。"
        向南移动的公式: "在地图上，向南通常意味着y坐标减少。因此，南侧30米的坐标可以表示为(x, y - 0.0003)。南侧3米的坐标可以表示为(x, y - 0.00003)"
        向东南移动的公式: "在地图上，向东南通常意味着x坐标增加，y坐标减少。因此，东南侧30米的坐标可以表示为(x + 0.0003, y - 0.0003)。东南侧3米的坐标可以表示为(x + 0.00003, y - 0.00003)"
    3. 示例描述
        具体示例: "如果xx公交站的坐标是(100, 200)，那么南侧40米的部署点的坐标是(100, 200 - 0.0004)，即(100, 199.9996)。"
        应用场景: "在xx公交站南侧40米处部署观察哨，该点的具体坐标可以通过上述计算得到。"'''

default = '''\
- 当指令中提到'附近'时，默认指在周围30米范围内，不要超过这个距离。

- 在当前的地图中，规定方位角azimuth为：0度正北顺时针方向，范围在-180~180度。其中在0~180度表示东侧，-180~0度表示西侧；-90~90度表示北侧，90~-90度表示南侧。

- 编组分为编队和实体，编队指将兵力实体组合成的有序队形或单位，实体指具体的兵力单位或装备。它们的关系是由若干的实体或编队组成更大的编队。同时将这样的编组结构称为层级化结构。

- 兵力实体即simentity，包括仿真环境中的装备、人员、工事等实体。

- 地理实体即geoentity，包括地理数据中的建筑、街道、公交站、商店等实体。'''

deploy = '''\
- 当部署指令中包括多个实体但未提到间隔时，默认间隔为15米。
- 当部署指令中包括多个实体但未提到队形时，默认队形为圆形。
- 当部署指令中指出方位但未提到距离时，默认距离为20米，且全部实体都要部署在这个方位。例如要求在xx东侧部署，则默认编组中心点位于xx东侧20米，且全部实体都在xx东侧，不要有实体在xx西侧的情况，如果有请重新指定编组中心点。
- 对于地面装备例如坦克，不要部署在道路上，要部署在道路旁边，便于隐蔽。
- 对于地面人员例如步兵，请尽量部署在建筑上，夺取制高点，但要注意和其他实体的间隔不要太大。
- 当地图中存在两个同名目标点时请选择一个合适的进行部署。例如要求将坦克部署在杨梅公交站南侧时，地图有2个杨梅公交站，然后你发现第一个杨梅站南侧没有道路，第二个杨梅站南侧有道路，而且部署对象是坦克，那么遵循坦克不要部署在道路上的规则，请选择第一个杨梅站进行部署。'''


# - 可以调用tool "polygon_formation"来计算多边形队形上各个坐标点。使用方法为: 输入队形中心点坐标、两两间距、部署数量，得到该队形中的各个坐标点。注意: 队形中心点仅仅用于定位队形，不要用于部署。
# - 可以调用tool "v_formation"来计算v型队形上各个坐标点。使用方法为: 输入队形中心点坐标、队形开口角度、两两间距、部署数量、旋转角度，得到该队形中的各个坐标点。
tool = '''\
"get_deploy_rules"
用途：获取兵力实体的部署规则。
使用方法：输入目标配置的兵力实体，得到相应的部署规则。

"get_nearby_geoentities"
用途：获取配置地点与附近地理实体的关系。
使用方法：输入目标配置地点的名称，得到配置地点与附近地理实体之间的关系三元组，表示为(目标配置地点, 关系, 附近地理实体)。关系中的'rcc'表示两者的区域连接演算关系， 'distance'表示两者间的距离，单位为米，'azimuth'表示该附近地理实体相对目标删除区域的方位角。从中筛选符合删除指令的实体。

"formaion_polygon"
用途：获取多边形队形下的各兵力实体坐标。
使用方法：输入编组中心点坐标、多边形顶点个数、两点间距，得到多边形各顶点的坐标列表，其中每个元素为一个坐标。

"formaion_line"
用途：获取直线队形下的各兵力实体坐标。
使用方法：输入编组中心点坐标、点个数、两点间距、朝向角，得到直线上各点的坐标列表，其中每个元素为一个坐标。

"get_new_point"
用途：根据当前点获取另一个点。
使用方法：输入当前点坐标、与当前点方位角、与当前点距离，得到目标点坐标。

"structure"
用途：输出兵力实体部署方案。
使用方法：按照编组层级关系，输出每个兵力实体的名称、所属阵营（红或蓝）、坐标。'''

## Using the think tool

# Before taking any action or responding to the user after receiving tool results, use the think tool as a scratchpad to:
# - List the specific rules that apply to the current request
# - Check if all required information is collected
# - Verify that the planned action complies with all policies
# - Iterate over tool results for correctness

# Here are some examples of what to iterate over inside the think tool:
# <think_tool_example_1>
# User wants to deploy cars on the east side of a building
# - Need to verify: building coordinates, building type, nearby entities, deployment results
# - Check results:
#   * Are the cars within the target area?
#   * Are the positions following the car rules?
# - Plan: calculate the distances, verify rules, rectify the positions
# </think_tool_example_1>


think = '''\
任务一: 在指定区域内配置用户指定编组（用户已指定队形）
步骤：
    1. 使用"get_deploy_rules"获取目标配置兵力实体的部署规则，明确部署约束条件。
    2. 使用"get_nearby_geoentities"获取目标区域内及周边的地理实体信息，用于辅助判断可部署区域与可用地理特征（如树林、建筑、沟壑等）。
    3. 根据地理实体和规则，使用相关工具（如几何计算工具）确定编组中心点。
    4. 用户已指定队形，请优先使用使用"get_formation"，根据中心点和队形信息，一次性获取该编组内所有兵力实体的位置。
    5. 使用"structure"输出完整的部署方案。

任务二: 在指定区域内配置用户指定编组（用户未指定队形）
步骤：
    1. 使用"get_deploy_rules"获取目标配置兵力实体的部署规则，明确部署约束条件。
    2. 使用"get_nearby_geoentities"获取目标区域内及周边的地理实体信息，用于辅助判断可部署区域与可用地理特征（如树林、建筑、沟壑等）。
    3. 根据地理实体和规则，使用相关工具（如几何计算工具）确定编组中心点。
    4. 根据任务内容与环境特点，从以下支持的队形库中自主选择最合适的队形。
        - 正多边形队形（如三角形、方形、五边形）
        - 直线队形（如横队、纵队）
    5. 使用"get_formation"，根据中心点和队形信息，一次性获取该编组内所有兵力实体的位置。
    6. 使用"structure"输出完整的部署方案。
    
任务三：在指定区域内配置零散兵力实体（不按照正常编组进行部署）
步骤：
    1. 使用"get_deploy_rules"获取零散兵力实体的部署规则，明确部署约束条件。
    2. 使用"get_nearby_geoentities"获取目标区域内及周边的地理实体信息，用于辅助判断可部署区域与可用地理特征（如树林、建筑、沟壑等）。
    3. 结合部署规则与地理实体，使用相关工具（如几何计算工具）识别多个适合单兵部署的小规模区域。
    4. 对每个兵力实体，逐个确定部署位置：
        - 优先选择满足遮蔽/隐蔽、地形适应性强的位置。
        - 保证部署间距、分布合理，避免集中。
        - 若任务目标涉及警戒、封锁、伏击等作战需求，可根据功能角色进行位置微调（如前置哨兵、中段火力点、后方掩护）。
    5. 使用 structure 输出所有零散兵力实体的最终部署方案。
    
注意：
- 请在每一次输出时在content内加入你输出该结果的理由，以便后续反思。
- 如果存在多个编组，可以多次调用工具，以便推理更高效。
- 优先使用"get_formation"简化部署过程，提高效率和一致性。
- 自主选择队形时，请考虑兵力数量、地形限制、部署规则等。
- 不允许在有成熟计算工具支持的情况下手动计算点坐标。
- 不允许将兵力实体配置在同一坐标下。
- 每次调用工具前请先查看对应的工具规则，确保工具的正确使用。'''